<!-- Flight Information Display -->
{{ $timeFormat := "15:04" }}
{{ $dateFormat := .Site.Params.dateFormat }}
<aside class="flight" itemscope itemtype="https://schema.org/Flight">
    <!-- Flight Date -->
    <h5>
        <time
            datetime="{{ if .Params.date }}{{ .Params.date | dateFormat "2006-01-02" }}{{ end }}"
            itemprop="departureTime"
        >
            {{ if .Params.date }}{{ .Params.date | dateFormat $dateFormat }}{{ end }}
        </time>
    </h5>
    <div class="flight-summary">
    {{ if .Params.flights }}
        <!-- Multiple flight segments -->
        {{ range .Params.flights }}
            {{ if .airport}}
            <div class="flight-airport" itemprop="departureAirport" itemscope itemtype="https://schema.org/Airport">
                {{ if .label }}<div>{{ .label }}</div>{{ end }}
                <strong itemprop="iataCode">{{ .airport }}</strong>
                {{ if .arrive }}<br>
                    <time itemprop="arrivalTime" datetime="{{ .arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}">
                        {{ .arrive | dateFormat $timeFormat }}
                    </time>
                {{ end }}
                {{ if .depart }}<br>
                    <time itemprop="departureTime" datetime="{{ .depart | dateFormat "2006-01-02T15:04:05Z07:00" }}">
                        {{ .depart | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>
            {{ end}}
            {{ if .flight }}
            <div class="flight-plane" itemprop="flight" itemscope itemtype="https://schema.org/Flight">
                <a
                    href="#flight-{{ .flight }}"
                    title="{{ .aircraft }}"
                    aria-label="Flight {{ .flight }} on {{ .aircraft }}"
                >
                    <span aria-hidden="true">&#x2708;</span>
                </a><br>
                <small class="flight-meta" itemprop="name">
                    <span itemprop="airline">{{ .airline }}</span>
                    <span itemprop="flightNumber">{{ .flight }}</span>
                </small>
            </div>
            {{ end }}
        {{ end }}
    </div>
    {{ else }}
        <!-- Single flight with optional via -->
        {{ if and .Params.from .Params.to }}
            <!-- From Airport -->
            <div class="flight-airport" itemprop="departureAirport" itemscope itemtype="https://schema.org/Airport">
                {{ i18n "flight.from" | default "from" }}<br>
                <strong itemprop="iataCode">{{ .Params.from }}</strong><br>
                {{ if .Params.depart }}
                    <time
                        itemprop="departureTime"
                        datetime="{{ .Params.depart | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                    >
                        {{ .Params.depart | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>

            <!-- Flight Info -->
            <div class="flight-plane" itemprop="flight" itemscope itemtype="https://schema.org/Flight">
                <a
                    href="#flight-{{ .Params.flight }}"
                    title="{{ .Params.aircraft }}"
                    aria-label="Flight {{ .Params.flight }} on {{ .Params.aircraft }}"
                >
                    <span aria-hidden="true">&#x2708;</span>
                </a><br>
                <small class="flight-meta" itemprop="name">
                    <span itemprop="airline">{{ .Params.airline }}</span>
                    <span itemprop="flightNumber">{{ .Params.flight }}</span>
                </small>
            </div>

            <!-- Via Airport (if present) -->
            {{ if .Params.via }}
                <div class="flight-airport" itemprop="arrivalAirport" itemscope itemtype="https://schema.org/Airport">
                    {{ i18n "flight.via" | default "via" }}<br>
                    <strong itemprop="iataCode">{{ .Params.via.airport }}</strong><br>
                    {{ if .Params.via.arrive }}
                        <time
                            itemprop="arrivalTime"
                            datetime="{{ .Params.via.arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                        >
                            {{ .Params.via.arrive | dateFormat $timeFormat }}
                        </time>
                    {{ end }}
                    {{ if .Params.via.depart }} -
                        <time
                            itemprop="departureTime"
                            datetime="{{ .Params.via.depart | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                        >
                            {{ .Params.via.depart | dateFormat $timeFormat }}
                        </time>
                    {{ end }}
                </div>

                <!-- Second flight for via -->
                <div class="flight-plane" itemprop="flight" itemscope itemtype="https://schema.org/Flight">
                    <a
                        href="#flight-{{ .Params.flight }}"
                        title="{{ .Params.aircraft }}"
                        aria-label="Flight {{ .Params.flight }} on {{ .Params.aircraft }}"
                    >
                        <span aria-hidden="true">&#x2708;</span>
                    </a><br>
                    <small class="flight-meta" itemprop="name">
                        <span itemprop="airline">{{ .Params.airline }}</span>
                        <span itemprop="flightNumber">{{ .Params.flight }}</span>
                    </small>
                </div>
            {{ end }}

            <!-- To Airport -->
            <div class="flight-airport" itemprop="arrivalAirport" itemscope itemtype="https://schema.org/Airport">
                {{ i18n "flight.to" | default "to" }}<br>
                <strong itemprop="iataCode">{{ .Params.to }}</strong><br>
                {{ if .Params.arrive }}
                    <time
                        itemprop="arrivalTime"
                        datetime="{{ .Params.arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                    >
                        {{ .Params.arrive | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>
        {{ else }}
            <!-- Error for missing flight data -->
            <div class="airport" role="alert">
                {{ i18n "flight.error.incomplete" | default "Flight information incomplete" }}
            </div>
        {{ end }}
    {{ end }}

    <!-- Flight Summary -->
    <p class="clear">
        <strong itemprop="name">{{ .Title }}</strong>
        {{ .Summary }}
    </p>
</aside>