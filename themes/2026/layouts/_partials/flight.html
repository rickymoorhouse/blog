<!-- Flight Information Display -->
{{ $timeFormat := "15:04" }}
{{ $dateFormat := .Site.Params.dateFormat }}
<aside class="flight" itemscope itemtype="https://schema.org/Flight">
    <!-- Flight Date -->
    <h5>
        <time
            datetime="{{ if .Params.date }}{{ .Params.date | dateFormat "2006-01-02" }}{{ end }}"
            itemprop="departureTime"
        >
            {{ if .Params.date }}{{ .Params.date | dateFormat $dateFormat }}{{ end }}
        </time>
    </h5>
    <div class="flight-summary">
    {{ if .Params.flights }}
        <!-- Multiple flight segments -->
        {{ range .Params.flights }}
            {{ if .airport}}
            <div class="flight-airport" itemprop="departureAirport" itemscope itemtype="https://schema.org/Airport">
                {{ if .label }}<div>{{ .label }}</div>{{ end }}
                <strong itemprop="iataCode">{{ .airport }}</strong>
                {{ if .arrive }}<br>
                    <time itemprop="arrivalTime" datetime="{{ .arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}">
                        {{ .arrive | dateFormat $timeFormat }}
                    </time>
                {{ end }}
                {{ if .depart }}<br>
                    <time itemprop="departureTime" datetime="{{ .depart | dateFormat "2006-01-02T15:04:05Z07:00" }}">
                        {{ .depart | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>
            {{ end}}
            {{ if .flight }}
            <div class="flight-plane" itemprop="flight" itemscope itemtype="https://schema.org/Flight">
                <a
                    href="#flight-{{ .flight }}"
                    title="{{ .aircraft }}"
                    aria-label="Flight {{ .flight }} on {{ .aircraft }}"
                >
                <span aria-hidden="true">
                    <svg class="plane-icon" viewBox="0 0 43 46" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <g transform="matrix(-14.4509,6.88885,-6.14735,-12.8954,102.815,35.4699)">
                            <path d="M4.294,1.854C4.453,1.852 4.191,2.784 4.196,3.329C4.2,3.873 4.537,4.819 4.378,4.821C4.219,4.822 3.439,3.367 3.439,3.367C3.439,3.367 4.135,1.856 4.294,1.854Z" />
                        </g>
                        <g transform="matrix(-14.4509,6.88885,-5.31668,-11.1529,78.3788,40.7924)">
                            <path d="M3.875,2.625C3.94,2.624 3.787,2.79 3.792,3.335C3.796,3.879 3.921,4.164 3.856,4.166C3.79,4.168 3.458,3.381 3.458,3.381C3.458,3.381 3.81,2.627 3.875,2.625Z" />
                        </g>
                        <g transform="matrix(-27.8297,13.2666,-1.49027,-3.12616,137.24,-19.887)">
                            <path d="M4.421,2.652C4.421,2.652 4.633,2.633 4.644,3.281C4.653,3.778 4.386,4.308 4.386,4.308C4.386,4.308 3.264,5.82 3.265,3.683C3.265,1.546 4.421,2.652 4.421,2.652Z" />
                        </g>
                    </svg>
                </span>
                </a><br>
                <small class="flight-meta" itemprop="name">
                    <span itemprop="airline">{{ .airline }}</span>
                    <span itemprop="flightNumber">{{ .flight }}</span>
                </small>
            </div>
            {{ end }}
        {{ end }}
    </div>
    {{ else }}
        <!-- Single flight with optional via -->
        {{ if and .Params.from .Params.to }}
            <!-- From Airport -->
            <div class="flight-airport" itemprop="departureAirport" itemscope itemtype="https://schema.org/Airport">
                {{ i18n "flight.from" | default "from" }}<br>
                <strong itemprop="iataCode">{{ .Params.from }}</strong><br>
                {{ if .Params.depart }}
                    <time
                        itemprop="departureTime"
                        datetime="{{ .Params.depart | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                    >
                        {{ .Params.depart | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>

            <!-- Flight Info -->
            <div class="flight-plane" itemprop="flight" itemscope itemtype="https://schema.org/Flight">
                <a
                    href="#flight-{{ .Params.flight }}"
                    title="{{ .Params.aircraft }}"
                    aria-label="Flight {{ .Params.flight }} on {{ .Params.aircraft }}"
                >
                <span aria-hidden="true">
                    <svg class="plane-icon" viewBox="0 0 43 46" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <g transform="matrix(-14.4509,6.88885,-6.14735,-12.8954,102.815,35.4699)">
                            <path d="M4.294,1.854C4.453,1.852 4.191,2.784 4.196,3.329C4.2,3.873 4.537,4.819 4.378,4.821C4.219,4.822 3.439,3.367 3.439,3.367C3.439,3.367 4.135,1.856 4.294,1.854Z" />
                        </g>
                        <g transform="matrix(-14.4509,6.88885,-5.31668,-11.1529,78.3788,40.7924)">
                            <path d="M3.875,2.625C3.94,2.624 3.787,2.79 3.792,3.335C3.796,3.879 3.921,4.164 3.856,4.166C3.79,4.168 3.458,3.381 3.458,3.381C3.458,3.381 3.81,2.627 3.875,2.625Z" />
                        </g>
                        <g transform="matrix(-27.8297,13.2666,-1.49027,-3.12616,137.24,-19.887)">
                            <path d="M4.421,2.652C4.421,2.652 4.633,2.633 4.644,3.281C4.653,3.778 4.386,4.308 4.386,4.308C4.386,4.308 3.264,5.82 3.265,3.683C3.265,1.546 4.421,2.652 4.421,2.652Z" />
                        </g>
                    </svg>
                </span>
                </a><br>
                <small class="flight-meta" itemprop="name">
                    <span itemprop="airline">{{ .Params.airline }}</span>
                    <span itemprop="flightNumber">{{ .Params.flight }}</span>
                </small>
            </div>

            <!-- Via Airport (if present) -->
            {{ if .Params.via }}
                <div class="flight-airport" itemprop="arrivalAirport" itemscope itemtype="https://schema.org/Airport">
                    {{ i18n "flight.via" | default "via" }}<br>
                    <strong itemprop="iataCode">{{ .Params.via.airport }}</strong><br>
                    {{ if .Params.via.arrive }}
                        <time
                            itemprop="arrivalTime"
                            datetime="{{ .Params.via.arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                        >
                            {{ .Params.via.arrive | dateFormat $timeFormat }}
                        </time>
                    {{ end }}
                    {{ if .Params.via.depart }} -
                        <time
                            itemprop="departureTime"
                            datetime="{{ .Params.via.depart | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                        >
                            {{ .Params.via.depart | dateFormat $timeFormat }}
                        </time>
                    {{ end }}
                </div>

                <!-- Second flight for via -->
                <div class="flight-plane" itemprop="flight" itemscope itemtype="https://schema.org/Flight">
                    <a
                        href="#flight-{{ .Params.flight }}"
                        title="{{ .Params.aircraft }}"
                        aria-label="Flight {{ .Params.flight }} on {{ .Params.aircraft }}"
                    >
                        <span aria-hidden="true">&#x2708;</span>
                    </a><br>
                    <small class="flight-meta" itemprop="name">
                        <span itemprop="airline">{{ .Params.airline }}</span>
                        <span itemprop="flightNumber">{{ .Params.flight }}</span>
                    </small>
                </div>
            {{ end }}

            <!-- To Airport -->
            <div class="flight-airport" itemprop="arrivalAirport" itemscope itemtype="https://schema.org/Airport">
                {{ i18n "flight.to" | default "to" }}<br>
                <strong itemprop="iataCode">{{ .Params.to }}</strong><br>
                {{ if .Params.arrive }}
                    <time
                        itemprop="arrivalTime"
                        datetime="{{ .Params.arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                    >
                        {{ .Params.arrive | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>
        {{ else }}
            <!-- Error for missing flight data -->
            <div class="airport" role="alert">
                {{ i18n "flight.error.incomplete" | default "Flight information incomplete" }}
            </div>
        {{ end }}
    {{ end }}

    <!-- Flight Summary -->
    <p class="clear">
        <strong itemprop="name">{{ .Title }}</strong>
        {{ .Summary }}
    </p>
</aside>