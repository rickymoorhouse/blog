{{/* Single Flight Partial - Handles single flight with optional via routing */}}
{{ $context := .context }}
{{ $timeFormat := .timeFormat }}

<div class="single-flight" role="list" aria-label="{{ i18n "flight.single_flight" | default "Flight route" }}">
    <!-- Departure Airport -->
    <div class="single-flight__segment single-flight__segment--from" role="listitem" itemscope itemtype="https://schema.org/Airport">
        <div class="single-flight__label">{{ i18n "flight.from" | default "from" }}</div>
        <div class="single-flight__airport">
            <strong itemprop="name">{{ $context.Params.from }}</strong>
        </div>
        {{ if $context.Params.depart }}
            <div class="single-flight__time">
                <time
                    class="single-flight__departure"
                    datetime="{{ $context.Params.depart | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                    itemprop="departureTime"
                >
                    {{ $context.Params.depart | dateFormat $timeFormat }}
                </time>
            </div>
        {{ end }}
    </div>

    <!-- Flight Segment -->
    <div class="single-flight__segment single-flight__segment--flight" role="listitem" itemscope itemtype="https://schema.org/Flight">
        <div class="single-flight__plane">
            <a
                href="#flight-{{ $context.Params.flight }}"
                class="single-flight__plane-icon"
                title="{{ i18n "flight.aircraft" $context.Params.aircraft | default (printf "Aircraft: %s" $context.Params.aircraft) }}"
                aria-label="{{ printf "Flight %s on %s" $context.Params.flight $context.Params.airline }}"
                itemprop="url"
            >
                <span aria-hidden="true">
                    <svg width="100%" height="100%" viewBox="0 0 43 46" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <g transform="matrix(-14.4509,6.88885,-6.14735,-12.8954,102.815,35.4699)">
                            <path d="M4.294,1.854C4.453,1.852 4.191,2.784 4.196,3.329C4.2,3.873 4.537,4.819 4.378,4.821C4.219,4.822 3.439,3.367 3.439,3.367C3.439,3.367 4.135,1.856 4.294,1.854Z" />
                        </g>
                        <g transform="matrix(-14.4509,6.88885,-5.31668,-11.1529,78.3788,40.7924)">
                            <path d="M3.875,2.625C3.94,2.624 3.787,2.79 3.792,3.335C3.796,3.879 3.921,4.164 3.856,4.166C3.79,4.168 3.458,3.381 3.458,3.381C3.458,3.381 3.81,2.627 3.875,2.625Z" />
                        </g>
                        <g transform="matrix(-27.8297,13.2666,-1.49027,-3.12616,137.24,-19.887)">
                            <path d="M4.421,2.652C4.421,2.652 4.633,2.633 4.644,3.281C4.653,3.778 4.386,4.308 4.386,4.308C4.386,4.308 3.264,5.82 3.265,3.683C3.265,1.546 4.421,2.652 4.421,2.652Z" />
                        </g>
                    </svg>
                </span>
            </a>
        </div>
        <div class="single-flight__details">
            <small class="single-flight__info" itemprop="name">
                <span itemprop="airline">{{ $context.Params.airline }}</span>
                <span itemprop="flightNumber">{{ $context.Params.flight }}</span>
            </small>
            {{ if $context.Params.aircraft }}
                <small class="single-flight__aircraft" itemprop="aircraft">
                    {{ $context.Params.aircraft }}
                </small>
            {{ end }}
        </div>
    </div>

    <!-- Via Airport (if present) -->
    {{ if $context.Params.via }}
        <div class="single-flight__segment single-flight__segment--via" role="listitem" itemscope itemtype="https://schema.org/Airport">
            <div class="single-flight__label">{{ i18n "flight.via" | default "via" }}</div>
            <div class="single-flight__airport">
                <strong itemprop="name">{{ $context.Params.via.airport }}</strong>
            </div>
            <div class="single-flight__times">
                {{ if $context.Params.via.arrive }}
                    <time
                        class="single-flight__arrival"
                        datetime="{{ $context.Params.via.arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                        itemprop="arrivalTime"
                    >
                        {{ $context.Params.via.arrive | dateFormat $timeFormat }}
                    </time>
                {{ end }}
                {{ if and $context.Params.via.arrive $context.Params.via.depart }}<span class="single-flight__time-separator"> - </span>{{ end }}
                {{ if $context.Params.via.depart }}
                    <time
                        class="single-flight__departure"
                        datetime="{{ $context.Params.via.depart | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                        itemprop="departureTime"
                    >
                        {{ $context.Params.via.depart | dateFormat $timeFormat }}
                    </time>
                {{ end }}
            </div>
        </div>

        <!-- Second flight segment for via -->
        <div class="single-flight__segment single-flight__segment--flight" role="listitem" itemscope itemtype="https://schema.org/Flight">
            <div class="single-flight__plane">
                <a
                    href="#flight-{{ $context.Params.flight }}"
                    class="single-flight__plane-icon"
                    title="{{ i18n "flight.aircraft" $context.Params.aircraft | default (printf "Aircraft: %s" $context.Params.aircraft) }}"
                    aria-label="{{ printf "Flight %s on %s" $context.Params.flight $context.Params.airline }}"
                    itemprop="url"
                >
                <span aria-hidden="true">
                    <svg width="100%" height="100%" viewBox="0 0 43 46" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <g transform="matrix(-14.4509,6.88885,-6.14735,-12.8954,102.815,35.4699)">
                            <path d="M4.294,1.854C4.453,1.852 4.191,2.784 4.196,3.329C4.2,3.873 4.537,4.819 4.378,4.821C4.219,4.822 3.439,3.367 3.439,3.367C3.439,3.367 4.135,1.856 4.294,1.854Z" />
                        </g>
                        <g transform="matrix(-14.4509,6.88885,-5.31668,-11.1529,78.3788,40.7924)">
                            <path d="M3.875,2.625C3.94,2.624 3.787,2.79 3.792,3.335C3.796,3.879 3.921,4.164 3.856,4.166C3.79,4.168 3.458,3.381 3.458,3.381C3.458,3.381 3.81,2.627 3.875,2.625Z" />
                        </g>
                        <g transform="matrix(-27.8297,13.2666,-1.49027,-3.12616,137.24,-19.887)">
                            <path d="M4.421,2.652C4.421,2.652 4.633,2.633 4.644,3.281C4.653,3.778 4.386,4.308 4.386,4.308C4.386,4.308 3.264,5.82 3.265,3.683C3.265,1.546 4.421,2.652 4.421,2.652Z" />
                        </g>
                    </svg>
                </span>
                </a>
            </div>
            <div class="single-flight__details">
                <small class="single-flight__info" itemprop="name">
                    <span itemprop="airline">{{ $context.Params.airline }}</span>
                    <span itemprop="flightNumber">{{ $context.Params.flight }}</span>
                </small>
                {{ if $context.Params.aircraft }}
                    <small class="single-flight__aircraft" itemprop="aircraft">
                        {{ $context.Params.aircraft }}
                    </small>
                {{ end }}
            </div>
        </div>
    {{ end }}

    <!-- Destination Airport -->
    <div class="single-flight__segment single-flight__segment--to" role="listitem" itemscope itemtype="https://schema.org/Airport">
        <div class="single-flight__label">{{ i18n "flight.to" | default "to" }}</div>
        <div class="single-flight__airport">
            <strong itemprop="name">{{ $context.Params.to }}</strong>
        </div>
        {{ if $context.Params.arrive }}
            <div class="single-flight__time">
                <time
                    class="single-flight__arrival"
                    datetime="{{ $context.Params.arrive | dateFormat "2006-01-02T15:04:05Z07:00" }}"
                    itemprop="arrivalTime"
                >
                    {{ $context.Params.arrive | dateFormat $timeFormat }}
                </time>
            </div>
        {{ end }}
    </div>
</div>